<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Site Incrível</title>

  <link rel="stylesheet" href="style.css">

  <script src="script.js" defer></script>
</head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão do Abrigo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/phosphor-icons"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .card { background-color: #1e1e2f; color: #e0e0e0; border-radius: 20px; border: 1px solid #3a3a5a; }
        .header { padding: 1.5rem; background-color: #2a2a40; border-bottom: 1px solid #3a3a5a; }
        .logo { background: linear-gradient(135deg, #8A2BE2, #4B0082); color: white; font-weight: 700; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0; }
        .tab-button.active { color: white; border-bottom-color: #8A2BE2; }
        .dog-list-item.active { background-color: #c4b5fd; color: #1e1e2f;}
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader { border: 4px solid rgba(255, 255, 255, 0.3); border-top-color: #8A2BE2; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 50; }
        .modal-content { background-color: #2a2a40; padding: 2rem; border-radius: 1rem; color: white; text-align: center; }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div id="app" class="flex flex-col md:flex-row h-screen">
        <aside class="w-full md:w-1/3 md:max-w-sm bg-gray-800 p-4 flex flex-col flex-shrink-0">
            <h2 class="text-2xl font-bold mb-4 text-purple-300">Cães do Abrigo</h2>
            <input id="search-bar" type="text" placeholder="Buscar por nome..." class="w-full p-2 mb-4 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
            <div id="dog-list" class="flex-grow overflow-y-auto"></div>
            <button id="add-new-dog" class="w-full mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition-colors">
                + Adicionar Novo Cão
            </button>
        </aside>

        <main class="w-full flex-grow p-6 overflow-y-auto">
            <div id="ficha-container" class="hidden">
                 <div class="card">
                    <div class="header flex items-center gap-4">
                        <div class="logo">C</div>
                        <div>
                            <h1 id="display-name" class="text-2xl font-bold text-white"></h1>
                            <p id="display-baia" class="text-sm text-purple-300 font-semibold"></p>
                        </div>
                        <div id="display-status" class="status-badge ml-auto px-3 py-1 rounded-full text-xs font-semibold uppercase"></div>
                        <button id="delete-dog-button" class="ml-4 text-red-400 hover:text-red-600"><i class="ph-fill ph-trash text-2xl"></i></button>
                    </div>
                    <div class="relative bg-gray-700 cursor-pointer" onclick="document.getElementById('photo-upload').click()">
                        <div id="photo-label" class="flex flex-col items-center justify-center w-full h-72 text-gray-400">
                            <i class="ph-fill ph-upload-simple text-4xl mb-2"></i><span>Clique para adicionar foto</span>
                        </div>
                        <input type="file" id="photo-upload" class="hidden" accept="image/*">
                        <img id="dog-image" src="#" alt="Foto do cão" class="w-full h-72 object-cover hidden" />
                    </div>
                    <div class="flex bg-gray-800 text-sm md:text-base">
                        <button class="tab-button active flex-grow p-4 font-semibold" onclick="openTab(event, 'Geral')">Geral</button>
                        <button class="tab-button flex-grow p-4 font-semibold" onclick="openTab(event, 'Saude')">Saúde</button>
                        <button class="tab-button flex-grow p-4 font-semibold" onclick="openTab(event, 'ExameFisico')">Exame</button>
                        <button class="tab-button flex-grow p-4 font-semibold" onclick="openTab(event, 'Comportamento')">Comport.</button>
                    </div>
                    <div id="form-content" class="p-6"></div>
                </div>
            </div>
            <div id="initial-message" class="flex items-center justify-center h-full">
                <div class="text-center text-gray-500"><i class="ph-fill ph-dog text-6xl"></i><h2 class="text-2xl mt-4">Selecione ou adicione um cão.</h2></div>
            </div>
            <div id="loading-screen" class="flex items-center justify-center h-full"><div class="loader"></div><p class="ml-4 text-lg">Conectando...</p></div>
        </main>
    </div>
    
    <div id="delete-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">Tem certeza?</h3>
            <p class="mb-6">Esta ação irá apagar a ficha do cão para sempre, não faça merda.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-delete" class="px-6 py-2 bg-gray-500 hover:bg-gray-600 rounded">Cancelar</button>
                <button id="confirm-delete" class="px-6 py-2 bg-red-600 hover:bg-red-700 rounded">Excluir</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, onSnapshot, addDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, listAll, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

const firebaseConfig = {

  apiKey: "AIzaSyDbnNi5jG7W5Olb5GCU98YIHhFzoGag2Tw",

  authDomain: "sistema-abrigo-usp-c2773.firebaseapp.com",

  projectId: "sistema-abrigo-usp-c2773",

  storageBucket: "sistema-abrigo-usp-c2773.firebasestorage.app",

  messagingSenderId: "124960237112",

  appId: "1:124960237112:web:2a0e3309ab1cc936a128cd"

};

        // --- INICIALIZAÇÃO E LÓGICA DO APP (não precisa mexer abaixo) ---
        
        let db, auth, storage;
        let userId = null;
        let currentDogId = null;
        let dogsData = [];
        let unsubscribe = null;

        const dogListEl = document.getElementById('dog-list');
        const fichaContainerEl = document.getElementById('ficha-container');
        const initialMessageEl = document.getElementById('initial-message');
        const loadingScreenEl = document.getElementById('loading-screen');
        const searchBarEl = document.getElementById('search-bar');
        
        async function main() {
            loadingScreenEl.classList.remove('hidden');
            initialMessageEl.classList.add('hidden');
            
            try {
                if(firebaseConfig.apiKey.includes("COLE_SUA_API_KEY_AQUI")) {
                    loadingScreenEl.innerHTML = `<p class='text-orange-400 text-center'><b>Atenção:</b> Cole suas credenciais do Firebase no código para o sistema funcionar.<br><br>Siga o passo a passo.</p>`;
                    return;
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                storage = getStorage(app);

                await signInAnonymously(auth);
                userId = auth.currentUser.uid;
                function loadDogs() {
    // COLE O ID DO SEU DOCUMENTO AQUI DENTRO DAS ASPAS
    const seuDocumentoId = "HnNTtPKvVFYthdUJjYAu"; 

    const docRef = doc(db, "caes", seuDocumentoId);
    unsubscribe = onSnapshot(docRef, (docSnap) => {
        if (docSnap.exists()) {
            const data = docSnap.data();
            dogsData = Object.keys(data).map(key => ({
                id: key, 
                ...data[key]
            }));
            // Organiza os cães em ordem numérica
            dogsData.sort((a, b) => parseInt(a.id) - parseInt(b.id)); 

            renderDogList(dogsData);
        } else {
            console.log("Documento de dados não encontrado!");
            dogListEl.innerHTML = '<p class="text-red-500 text-center">Documento de dados não encontrado. Verifique o ID no código.</p>';
        }

        loadingScreenEl.classList.add('hidden');

        if (dogsData.length > 0 && !currentDogId) {
             initialMessageEl.classList.remove('hidden');
             fichaContainerEl.classList.add('hidden');
        } else if (dogsData.length === 0) {
             initialMessageEl.classList.remove('hidden');
             fichaContainerEl.classList.add('hidden');
        }

        if (currentDogId) {
            const currentDogData = dogsData.find(dog => dog.id === currentDogId);
            if (currentDogData) renderFicha(currentDogData);
            else resetView();
        }
    });
}
            const dogsCol = collection(db, `caes`);
            unsubscribe = onSnapshot(dogsCol, (snapshot) => {
                dogsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderDogList(dogsData);
                loadingScreenEl.classList.add('hidden');

                if (dogsData.length > 0 && !currentDogId) {
                     initialMessageEl.classList.remove('hidden');
                     fichaContainerEl.classList.add('hidden');
                } else if (dogsData.length === 0) {
                     initialMessageEl.classList.remove('hidden');
                     fichaContainerEl.classList.add('hidden');
                }
                
                if (currentDogId) {
                    const currentDogData = dogsData.find(dog => dog.id === currentDogId);
                    if (currentDogData) renderFicha(currentDogData);
                    else resetView();
                }
            });
        }

        function renderDogList(dogs) {
            dogListEl.innerHTML = '';
            if (dogs.length === 0) {
                dogListEl.innerHTML = '<p class="text-gray-500 text-center">Nenhum cão cadastrado.</p>';
                return;
            }
            const sortedDogs = dogs.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
            sortedDogs.forEach(dog => {
                const item = document.createElement('div');
                item.className = `dog-list-item p-3 mb-2 rounded-lg cursor-pointer hover:bg-purple-300 transition-colors ${dog.id === currentDogId ? 'active' : 'bg-gray-700'}`;
                item.dataset.id = dog.id;
                item.innerHTML = `<p class="text-lg">${dog.name || 'Cão sem nome'}</p><p class="text-xs text-gray-400">Baia: ${dog.baia || 'N/A'}</p>`;
                item.addEventListener('click', () => selectDog(dog.id));
                dogListEl.appendChild(item);
            });
        }
        
        function renderFicha(dog) {
            initialMessageEl.classList.add('hidden');
            fichaContainerEl.classList.remove('hidden');
            currentDogId = dog.id;

            document.getElementById('display-name').textContent = dog.name || "Nome do Cão";
            document.getElementById('display-baia').textContent = `Baia: ${dog.baia || '??'}`;
            updateStatusBadge(dog.status || 'Disponível para Adoção');

            const dogImage = document.getElementById('dog-image');
            const photoLabel = document.getElementById('photo-label');
            if (dog.photo_base64) {
                dogImage.src = dog.photo_base64;
                dogImage.classList.remove('hidden');
                photoLabel.classList.add('hidden');
            } else {
                dogImage.src = '';
                dogImage.classList.add('hidden');
                photoLabel.classList.remove('hidden');
            }

            document.getElementById('form-content').innerHTML = getFormFieldsHTML(dog);
            attachFormListeners();
        }

        function selectDog(id) {
            const dog = dogsData.find(d => d.id === id);
            if (dog) {
                currentDogId = id;
                renderFicha(dog);
                renderDogList(dogsData); 
            }
        }

        async function handleAddNewDog() {
            const newDogData = { name: "Novo Cão", baia: "", status: "Disponível para Adoção", createdAt: new Date() };
            try {
                const docRef = await addDoc(collection(db, `caes`), newDogData);
                selectDog(docRef.id);
            } catch (error) { console.error("Erro ao adicionar: ", error); }
        }
        
        async function handleUpdate(event) {
            if (!currentDogId) return;
            const field = event.target;
            const dogRef = doc(db, `caes`, currentDogId);
            try { await updateDoc(dogRef, { [field.name]: field.value }); } 
            catch (error) { console.error("Erro ao salvar:", error); }
        }

        async function handlePhotoUpdate(event) {
            if (!currentDogId || !event.target.files || !event.target.files[0]) return;
            const file = event.target.files[0];

            const MAX_WIDTH = 800;
            const MAX_HEIGHT = 800;
            const reader = new FileReader();

            reader.onload = (e) => {
                const img = new Image();
                img.onload = async () => {
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > MAX_WIDTH) {
                            height *= MAX_WIDTH / width;
                            width = MAX_WIDTH;
                        }
                    } else {
                        if (height > MAX_HEIGHT) {
                            width *= MAX_HEIGHT / height;
                            height = MAX_HEIGHT;
                        }
                    }

                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const resizedBase64 = canvas.toDataURL('image/jpeg', 0.85);

                    const dogRef = doc(db, `caes`, currentDogId);
                    try {
                        await updateDoc(dogRef, { photo_base64: resizedBase64 });
                    } catch (error) {
                        console.error("Erro ao salvar foto:", error);
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        async function handleDeleteDog() {
            if (!currentDogId) return;
            try {
                await deleteDoc(doc(db, `caes`, currentDogId));
                resetView();
            } catch (error) { console.error("Erro ao excluir:", error); }
        }

        function resetView() {
            currentDogId = null;
            fichaContainerEl.classList.add('hidden');
            initialMessageEl.classList.remove('hidden');
            renderDogList(dogsData);
        }

        function updateStatusBadge(status) {
            const badge = document.getElementById('display-status');
            badge.textContent = status;
            badge.className = 'status-badge ml-auto px-3 py-1 rounded-full text-xs font-semibold uppercase text-white';
            if (status === 'Disponível para Adoção') badge.classList.add('bg-green-500');
            else if (status === 'Em Tratamento') badge.classList.add('bg-orange-500');
            else if (status === 'Quarentena') badge.classList.add('bg-red-500');
        }
        
        function getFormFieldsHTML(data = {}) {
            return `
                <div id="Geral" class="tab-content block space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div><label class="text-sm text-gray-400">Nome</label><input type="text" name="name" value="${data.name || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">ID da Baia</label><input type="text" name="baia" value="${data.baia || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">Status</label>
                            <select name="status" class="w-full bg-gray-700 p-2 rounded border border-gray-600">
                                <option ${data.status === 'Disponível para Adoção' ? 'selected' : ''}>Disponível para Adoção</option>
                                <option ${data.status === 'Em Tratamento' ? 'selected' : ''}>Em Tratamento</option>
                                <option ${data.status === 'Quarentena' ? 'selected' : ''}>Quarentena</option>
                            </select>
                        </div>
                        <div><label class="text-sm text-gray-400">Sexo</label><input type="text" name="sexo" value="${data.sexo || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">Castrado?</label><input type="text" name="castrado" value="${data.castrado || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">Idade Estimada</label><input type="text" name="idade" value="${data.idade || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">Porte</label><input type="text" name="porte" value="${data.porte || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">Pelagem/Cor</label><input type="text" name="pelagem" value="${data.pelagem || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                    </div>
                </div>
                <div id="Saude" class="tab-content hidden space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div><label class="text-sm text-gray-400">Última Vacina</label><input type="text" name="vacina" value="${data.vacina || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">Último Vermífugo</label><input type="text" name="vermifugo" value="${data.vermifugo || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-sm text-gray-400">Último Antipulgas</label><input type="text" name="antipulgas" value="${data.antipulgas || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                    </div>
                    <div><label class="text-sm text-gray-400">Condições Médicas Crônicas</label><textarea name="condicoes" class="w-full bg-gray-700 p-2 rounded border border-gray-600 h-24">${data.condicoes || ''}</textarea></div>
                    <div><label class="text-sm text-gray-400">Medicação Contínua</label><textarea name="medicacao" class="w-full bg-gray-700 p-2 rounded border border-gray-600 h-24">${data.medicacao || ''}</textarea></div>
                     <div class="mt-6">
                        <label class="text-sm text-gray-400">Documentos Anexados</label>
                        <div class="mt-2 p-4 bg-gray-800 rounded-lg border border-gray-600">
                            <div id="file-list" class="space-y-2 mb-4">
                                <p class="text-gray-500">Nenhum documento anexado.</p>
                            </div>
                            <label for="file-upload" class="cursor-pointer bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition-colors text-sm">
                                + Anexar Novo Documento
                            </label>
                            <input type="file" id="file-upload" class="hidden">
                        </div>
                    </div>
                </div>
                <div id="ExameFisico" class="tab-content hidden space-y-4">
                    <div><label class="text-sm text-gray-400">Data do Exame</label><input type="date" name="exame_data" value="${data.exame_data || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div><label class="text-xs text-gray-400">Peso (kg)</label><input type="text" name="exame_peso" value="${data.exame_peso || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-xs text-gray-400">Temp (°C)</label><input type="text" name="exame_temp" value="${data.exame_temp || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-xs text-gray-400">FC (bpm)</label><input type="text" name="exame_fc" value="${data.exame_fc || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-xs text-gray-400">FR (mpm)</label><input type="text" name="exame_fr" value="${data.exame_fr || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-xs text-gray-400">TRC (s)</label><input type="text" name="exame_trc" value="${data.exame_trc || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-xs text-gray-400">Mucosas</label><input type="text" name="exame_mucosas" value="${data.exame_mucosas || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-xs text-gray-400">Hidratação</label><input type="text" name="exame_hidratacao" value="${data.exame_hidratacao || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                        <div><label class="text-xs text-gray-400">Escore Corp.</label><input type="text" name="exame_escore" value="${data.exame_escore || ''}" class="w-full bg-gray-700 p-2 rounded border border-gray-600"></div>
                    </div>
                    <div><label class="text-sm text-gray-400">Pele e Pelagem</label><textarea name="exame_pele" class="w-full bg-gray-700 p-2 rounded border border-gray-600 h-20">${data.exame_pele || ''}</textarea></div>
                    <div><label class="text-sm text-gray-400">Olhos / Ouvidos</label><textarea name="exame_olhos_ouvidos" class="w-full bg-gray-700 p-2 rounded border border-gray-600 h-20">${data.exame_olhos_ouvidos || ''}</textarea></div>
                    <div><label class="text-sm text-gray-400">Sistemas</label><textarea name="exame_sistemas" class="w-full bg-gray-700 p-2 rounded border border-gray-600 h-24">${data.exame_sistemas || ''}</textarea></div>
                    <div><label class="text-sm text-gray-400">Observações Gerais</label><textarea name="exame_obs" class="w-full bg-gray-700 p-2 rounded border border-gray-600 h-24">${data.exame_obs || ''}</textarea></div>
                </div>
                <div id="Comportamento" class="tab-content hidden">
                    <div><label class="text-sm text-gray-400">Observações de Comportamento</label><textarea name="comportamento" class="w-full bg-gray-700 p-2 rounded border border-gray-600 h-48">${data.comportamento || ''}</textarea></div>
                </div>
            `;
        }
        
        function attachFormListeners() {
            document.querySelectorAll('#form-content input, #form-content select, #form-content textarea').forEach(el => {
                el.addEventListener('change', handleUpdate);
            });
            document.getElementById('photo-upload').addEventListener('change', handlePhotoUpdate);
            
            // Novas adições para os arquivos
            document.getElementById('file-upload').addEventListener('change', handleFileUpload);
            if(currentDogId) {
                loadFiles(currentDogId);
            }
        }

        document.getElementById('add-new-dog').addEventListener('click', handleAddNewDog);
        searchBarEl.addEventListener('input', (e) => {
            const filteredDogs = dogsData.filter(dog => (dog.name || '').toLowerCase().includes(e.target.value.toLowerCase()));
            renderDogList(filteredDogs);
        });
        
        const deleteModal = document.getElementById('delete-modal');
        document.getElementById('delete-dog-button').addEventListener('click', () => deleteModal.classList.remove('hidden'));
        document.getElementById('cancel-delete').addEventListener('click', () => deleteModal.classList.add('hidden'));
        document.getElementById('confirm-delete').addEventListener('click', () => {
            handleDeleteDog();
            deleteModal.classList.add('hidden');
        });

        main();

        window.openTab = (evt, tabName) => {
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(tb => tb.classList.remove('active'));
            document.getElementById(tabName).classList.remove('hidden');
            evt.currentTarget.classList.add('active');
        }

        // --- FUNÇÕES PARA GERENCIAR ARQUIVOS (ANEXOS) ---

        // Função para lidar com o upload de um novo arquivo
        async function handleFileUpload(event) {
            if (!currentDogId || !event.target.files || !event.target.files[0]) return;
            const file = event.target.files[0];
            const filePath = `caes/${currentDogId}/${file.name}`;
            const fileRef = ref(storage, filePath);

            try {
                // Mostra um feedback visual de que o upload começou
                const fileListEl = document.getElementById('file-list');
                fileListEl.innerHTML = '<p class="text-purple-300">Enviando arquivo...</p>';
                
                await uploadBytes(fileRef, file);
                console.log("Arquivo enviado com sucesso!");
                
                // Limpa o input de arquivo e atualiza a lista
                document.getElementById('file-upload').value = ''; 
                await loadFiles(currentDogId);

            } catch (error) {
                console.error("Erro no upload do arquivo:", error);
                alert("Ocorreu um erro ao enviar o arquivo.");
                await loadFiles(currentDogId); // Recarrega a lista mesmo em caso de erro
            }
        }
        
        // Função para carregar e exibir a lista de arquivos de um cão
        async function loadFiles(dogId) {
            const fileListEl = document.getElementById('file-list');
            fileListEl.innerHTML = '<p class="text-gray-500">Carregando documentos...</p>';
            
            const listRef = ref(storage, `caes/${dogId}`);
            try {
                const res = await listAll(listRef);
                if (res.items.length === 0) {
                    fileListEl.innerHTML = '<p class="text-gray-500">Nenhum documento anexado.</p>';
                    return;
                }

                fileListEl.innerHTML = ''; // Limpa a lista
                for (const itemRef of res.items) {
                    const url = await getDownloadURL(itemRef);
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'flex items-center justify-between bg-gray-700 p-2 rounded';
                    fileDiv.innerHTML = `
                        <a href="${url}" target="_blank" class="text-purple-300 hover:underline truncate pr-4">${itemRef.name}</a>
                        <button data-filepath="${itemRef.fullPath}" class="delete-file-btn text-red-400 hover:text-red-600 text-xs">Excluir</button>
                    `;
                    fileListEl.appendChild(fileDiv);
                }
                
                // Adiciona listeners para os novos botões de exclusão
                document.querySelectorAll('.delete-file-btn').forEach(button => {
                    button.addEventListener('click', handleDeleteFile);
                });

            } catch (error) {
                console.error("Erro ao listar arquivos:", error);
                fileListEl.innerHTML = '<p class="text-red-400">Erro ao carregar documentos.</p>';
            }
        }

        // Função para deletar um arquivo
        async function handleDeleteFile(event) {
            const filePath = event.target.dataset.filepath;
            if (!filePath || !confirm(`Tem certeza que deseja excluir o arquivo "${filePath.split('/').pop()}"?`)) return;

            const fileRef = ref(storage, filePath);
            try {
                await deleteObject(fileRef);
                console.log("Arquivo excluído com sucesso!");
                await loadFiles(currentDogId); // Atualiza a lista
            } catch (error) {
                console.error("Erro ao excluir arquivo:", error);
                alert("Não foi possível excluir o arquivo.");
            }
        }
    </script>
</body>
</html>
